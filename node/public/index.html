<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grover</title>
  <link rel="shortcut icon" type="image/png" href="/public/Images/favicon.png"/>
  <!-- Latest compiled and minified CSS & JS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://code.jquery.com/jquery.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>


</head>
<body>
    <header>
         <nav class="navbar navbar-light" style="background-color: #28a745;">
             <div class="container d-flex justify-content-between">
                <a  class="navbar-brand d-flex align-items-center" >
          
                  <h3 class = "text-white" font-size = "12"><strike>Oscar 2.0</strike> Grover</h3>
                </a>
              </div>
          </nav>

      </header>

      <br>
      <br>
      <div class="container">
        <div class="row">

          <!-- <div class="col d-flex justify-content-center text-center">
            <div class="card" style="width: 25rem;">
              <div class="card-body">
                <h5 class="text-center">File Upload</h5>
                <p class="card-text">Click Here to Upload a File</p>
      
                <form target="http://localhost:8080/" action="http://104.248.69.73:8080/pdfpost" method="POST" enctype="multipart/form-data"> 
                  <input name="foo" type="file"> 
                  <hr>
                  <input class="btn btn-success" id="add-data" type="submit" value="Submit">


              </form> 

              </div>
            </div>
          </div> -->


          <div class="col d-flex justify-content-center text-center">
            <div class="card" style="width: 25rem;">
              <div class="card-body">
                <h5 class="text-center">File Upload</h5>
                <p class="card-text">Click Here to Upload a File</p>
      
                <form id ="file-form"> 
                  <input id="file-name" name="foo" type="file"> 
                  <hr>
                  <input class="btn btn-success" id="add-data" type="submit" value="Submit">


              </form> 

              </div>
            </div>
          </div>




          <!-- <div class="col d-flex justify-content-center text-center">
              <div class="card" style="width: 25rem;">
                <div class="card-body">
                  <h5 class="text-center">File Download</h5>
                  <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's content.</p>
                   <a href="#" class="btn btn-success">Go somewhere</a> 

                   <form id="file-form" action="main.js" method="POST">
                      <input type="file" id="file-select" name="foo" multiple/>
                      <hr>
                      <button class="btn btn-success" type="submit" id="upload-button">Upload</button>
                    </form> -->
                </div>
              </div>
            </div> 

        </div>
      </div>


  <!-- <div class="container">
    <div class="jumbotron">
      
      <h3></h3>
      <hr>
      <a href="/add"><button class="btn btn-danger btn-lg"><span></span> First Project</button></a>
      <a href="/all"><button class="btn btn-danger btn-lg"><span></span> Second Project</button></a>
    </div>

  </div> -->


  <!-- <script type="text/javascript" src="./main.js"></script> -->

  <script>

$.ajaxSetup({
  beforeSend:function(jqXHR,settings){
    if (settings.dataType === 'binary'){
      settings.xhr().responseType='arraybuffer';
      settings.processData=false;
    }
  }
})

    var pdfName;

    $("#file-form").on("submit", function(event) {
    event.preventDefault() 
    var filePath = $("#file-name").val();
        pdfName = filePath.replace(/^.*[\\\/]/, '');
    var formData = new FormData(this);

    $.ajax({
        url: "http://104.248.69.73:8080/pdfpost",
        type: 'POST',
        data: formData,
        async: false,
        cache: false,
        contentType: false,
        processData: false,
        success: function () {
            alert('File Submitted!');
        }
      // }).then(function(data) {
      //       console.log(data);

      //   })
    }).then(makecsv())
});



function makecsv() {
  
  $.ajax({
        url: "http://104.248.69.73:4000/tabcsv?pdf="+pdfName,
        type: 'GET',
        dataType: 'text',
        success: function (data) {
          if(data){
            console.log(data);
          }
        }
      }).then(getcsv())
}

function getcsv() {
  $.ajax({
        url: "http://104.248.69.73:8080/csvgrab?filename="+"tableTEST.csv",
        type: 'GET',
        dataType: 'binary',
        success: function (data) {
          console.log(data); //ArrayBuffer
          console.log(new Blob([data])) // Blob
        }
      }).then(console.log("KEEP CODING BELOW HERE"))
}


// function getjson() {
//   $.ajax({
//         url: "http://104.248.69.73:4000/tab?pdf="+pdfName,
//         type: 'GET',
//         dataType: 'blob',
//         success: function (data) {
//             console.log("JSON BELOW");
//         }
//       }).then(function(data) {
//             console.log(data);
//         })
// }


  </script>

</body>
</html>
